<!DOCTYPE html>
<html>
<head>
<title>The Labyrinth</title>
<meta charset="UTF-8">
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
<style>
    body { margin: 0; }
    #terminal-screen {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.9);
        color: lime;
        font-family: 'Courier New', Courier, monospace;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
    }
    .terminal-box {
        width: 90%;
        max-width: 450px;
        padding: 25px;
        background: rgba(0,20,0,0.95);
        border: 2px solid lime;
        border-radius: 5px;
        text-align: center;
    }
    .terminal-box input {
        width: 80%; padding: 10px; margin-bottom: 10px; background: #000;
        color: lime; border: 1px solid lime; text-transform: uppercase;
    }
    .terminal-box button {
        padding: 10px 20px; background: lime; color: #000;
        border: none; cursor: pointer; font-weight: bold;
    }
    #chat-link-btn {
        display: inline-flex; align-items: center; justify-content: center;
        padding: 15px 25px; margin-top: 20px; font-size: 1.2rem;
        color: lime; background-color: transparent; border: 2px solid lime;
        border-radius: 5px; text-decoration: none; transition: all 0.3s ease;
    }
    #chat-link-btn:hover { background-color: lime; color: #000; }
    #chat-link-btn svg { width: 24px; height: 24px; margin-right: 10px; fill: currentColor; }
</style>
</head>
<body>

<div id="terminal-screen">
    </div>

<a-scene environment="preset: tron; groundColor: #444; grid: none;">
    
    <a-entity id="player" position="1.5 1.6 1.5"
              camera
              look-controls
              wasd-controls="acceleration: 60; fly: false">
    </a-entity>

    <a-entity id="maze"></a-entity>
    
</a-scene>

<script>
    const mazeContainer = document.getElementById('maze');
    const terminalScreen = document.getElementById('terminal-screen');
    const WALL_HEIGHT = 3;
    const WALL_THICKNESS = 0.2;

    const mazeMap = [
        [1, 1, 1, 1, 1, 1, 1],
        [1, 0, 0, 1, 0, 0, 1],
        [1, 1, 0, 1, 0, 1, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 1, 1, 0, 1],
        [1, 0, 0, 0, 1, 'E', 1],
        [1, 1, 1, 1, 1, 1, 1]
    ];

    function createMaze() {
        mazeMap.forEach((row, z) => {
            row.forEach((cell, x) => {
                if (cell === 1) {
                    const wall = document.createElement('a-box');
                    wall.setAttribute('position', `${x} ${WALL_HEIGHT / 2} ${z}`);
                    wall.setAttribute('depth', 1);
                    wall.setAttribute('width', 1);
                    wall.setAttribute('height', WALL_HEIGHT);
                    wall.setAttribute('color', '#555');
                    wall.setAttribute('material', 'roughness: 0.8; metalness: 0.5');
                    wall.setAttribute('static-body', ''); // For physics
                    mazeContainer.appendChild(wall);
                } else if (cell === 'E') {
                    // Padlock visual
                    const padlockBase = document.createElement('a-box');
                    padlockBase.setAttribute('position', `${x} 1.2 0.45`);
                    padlockBase.setAttribute('scale', '0.6 0.5 0.1');
                    padlockBase.setAttribute('color', '#FFC107');
                    
                    const padlockTop = document.createElement('a-torus');
                    padlockTop.setAttribute('position', `${x} 1.6 0.45`);
                    padlockTop.setAttribute('scale', '0.2 0.2 0.2');
                    padlockTop.setAttribute('radius', '0.5');
                    padlockTop.setAttribute('radius-tubular', '0.1');
                    padlockTop.setAttribute('arc', '180');
                    padlockTop.setAttribute('rotation', '0 0 180');
                    padlockTop.setAttribute('color', '#FFC107');

                    mazeContainer.appendChild(padlockBase);
                    mazeContainer.appendChild(padlockTop);
                    
                    // Invisible Trigger Box
                    const trigger = document.createElement('a-box');
                    trigger.setAttribute('position', `${x} 1.5 ${z-0.5}`);
                    trigger.setAttribute('width', '1');
                    trigger.setAttribute('height', '3');
                    trigger.setAttribute('depth', '0.2');
                    trigger.setAttribute('visible', 'false');
                    trigger.setAttribute('end-trigger', ''); // Custom component
                    mazeContainer.appendChild(trigger);
                }
            });
        });
    }

    // A-Frame component to detect player entering the trigger box
    AFRAME.registerComponent('end-trigger', {
        init: function () {
            this.player = document.querySelector('#player');
            this.triggered = false;
        },
        tick: function () {
            if (this.triggered) return;

            const playerPos = this.player.getAttribute('position');
            const triggerPos = this.el.getAttribute('position');
            const distance = playerPos.distanceTo(triggerPos);

            if (distance < 1.5) {
                this.triggered = true;
                triggerTerminal();
            }
        }
    });

    function triggerTerminal() {
        // Disable player movement
        const playerEl = document.querySelector('#player');
        playerEl.removeAttribute('wasd-controls');
        playerEl.removeAttribute('look-controls');

        terminalScreen.style.display = 'flex';
        terminalScreen.innerHTML = `
            <div class="terminal-box">
                <h3>SYSTEM TERMINAL</h3><p>PASSWORD REQUIRED</p>
                <input type="text" id="password" autofocus>
                <button id="unlockBtn">UNLOCK</button>
            </div>`;

        const passwordInput = document.getElementById('password');
        document.getElementById('unlockBtn').onclick = () => checkPassword(passwordInput.value);
        passwordInput.onkeyup = (e) => { if (e.key === 'Enter') checkPassword(passwordInput.value); };
    }

    function checkPassword(pass) {
        if (pass.trim().toLowerCase() === 'verge') {
            terminalScreen.innerHTML = `
            <div class="terminal-box">
                <h2>ACCESS GRANTED</h2>
                <p>I'm thinking of a character. You'll have to guess who I am before I help you further.</p>
                <a href="https://gemini.google.com/gem/9dc507686e22" target="_blank" id="chat-link-btn">
                    <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"></path></svg>
                    <span>Chat for next clue</span>
                </a>
            </div>`;
        } else {
           alert('ACCESS DENIED');
           const passwordInput = document.getElementById('password');
           if (passwordInput) {
               passwordInput.value = '';
               passwordInput.focus();
           }
        }
    }

    createMaze();
</script>

</body>
</html>
