<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Labyrinth</title>
<style>
    body {
        background-color: #000;
        color: #fff;
        font-family: 'Courier New', Courier, monospace;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        overflow: hidden;
    }
    #scene {
        width: 80vw;
        height: 80vh;
        max-width: 1000px;
        max-height: 750px;
        perspective: 900px;
        border: 2px solid #555;
    }
    #world {
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
        transition: transform 0.4s linear;
    }
    .wall, .floor, .padlock {
        position: absolute;
        transform-style: preserve-3d;
    }
    .floor {
        background: #4a4a4a;
        transform: rotateX(90deg);
    }
    .wall-face {
        position: absolute;
        background: #6b6b6b;
        background-image: linear-gradient(45deg, #787878 25%, transparent 25%), linear-gradient(-45deg, #787878 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #787878 75%), linear-gradient(-45deg, transparent 75%, #787878 75%);
        background-size: 60px 60px;
        border: 1px solid #333;
        backface-visibility: hidden;
    }
    .padlock-icon {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .padlock-icon svg {
        width: 70%;
        height: 70%;
        fill: #ffc107;
        filter: drop-shadow(0 0 10px #ffc107);
    }
    #terminal-screen {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.85);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
    }
    .terminal-box {
        width: 400px; padding: 20px; background: rgba(0,20,0,0.9);
        border: 2px solid lime; border-radius: 5px; text-align: center;
    }
    .terminal-box input { width: 80%; padding: 10px; margin-bottom: 10px; background: #000; color: lime; border: 1px solid lime; text-transform: uppercase; }
    .terminal-box button { padding: 10px 20px; background: lime; color: #000; border: none; cursor: pointer; }
    #keyboard-hints {
        position: fixed;
        bottom: 20px;
        background-color: rgba(0,0,0,0.7);
        padding: 10px 20px;
        border-radius: 5px;
        border: 1px solid #444;
        transition: opacity 1s ease-out 1s;
    }
</style>
</head>
<body>

<div id="scene">
    <div id="world"></div>
</div>

<div id="terminal-screen">
    </div>

<div id="keyboard-hints">
    Use Arrow Keys to Navigate
</div>

<script>
    const world = document.getElementById('world');
    const terminalScreen = document.getElementById('terminal-screen');
    const keyboardHints = document.getElementById('keyboard-hints');

    const TILE_SIZE = 200; // The size of each square tile in pixels

    // 1 = Wall, 0 = Path, 'S' = Start, 'E' = End-zone
    const mazeMap = [
        [1, 1, 1, 1, 1, 1, 1],
        [1, 'S', 0, 1, 0, 0, 1],
        [1, 1, 0, 1, 0, 1, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 1, 1, 0, 1],
        [1, 0, 0, 0, 1, 'E', 1],
        [1, 1, 1, 1, 1, 1, 1]
    ];

    const player = { x: 1, y: 1, rot: 0 }; // rot is degrees

    function getStartPosition() {
        for (let y = 0; y < mazeMap.length; y++) {
            for (let x = 0; x < mazeMap[y].length; x++) {
                if (mazeMap[y][x] === 'S') {
                    player.x = x;
                    player.y = y;
                    return;
                }
            }
        }
    }

    function createFace(w, h, x, y, z, rx, ry, rz) {
        const face = document.createElement('div');
        face.className = 'wall-face';
        face.style.width = `${w}px`;
        face.style.height = `${h}px`;
        face.style.transform = `translate3d(${x}px, ${y}px, ${z}px) rotateX(${rx}deg) rotateY(${ry}deg) rotateZ(${rz}deg)`;
        return face;
    }

    function createMaze() {
        const wallHeight = TILE_SIZE;
        for (let y = 0; y < mazeMap.length; y++) {
            for (let x = 0; x < mazeMap[y].length; x++) {
                if (mazeMap[y][x] === 0 || mazeMap[y][x] === 'S') {
                    const floor = document.createElement('div');
                    floor.className = 'floor';
                    floor.style.width = `${TILE_SIZE}px`;
                    floor.style.height = `${TILE_SIZE}px`;
                    floor.style.transform = `translate3d(${x * TILE_SIZE}px, ${wallHeight / 2}px, ${y * TILE_SIZE}px) rotateX(90deg)`;
                    world.appendChild(floor);
                }
                if (mazeMap[y][x] === 1) {
                    const wallX = x * TILE_SIZE;
                    const wallY = 0;
                    const wallZ = y * TILE_SIZE;
                    // Create a cube of wall faces
                    world.appendChild(createFace(TILE_SIZE, wallHeight, wallX, wallY, wallZ - TILE_SIZE / 2, 0, 0, 0)); // Front
                    world.appendChild(createFace(TILE_SIZE, wallHeight, wallX, wallY, wallZ + TILE_SIZE / 2, 0, 180, 0)); // Back
                    world.appendChild(createFace(TILE_SIZE, wallHeight, wallX - TILE_SIZE / 2, wallY, wallZ, 0, 90, 0)); // Left
                    world.appendChild(createFace(TILE_SIZE, wallHeight, wallX + TILE_SIZE / 2, wallY, wallZ, 0, -90, 0)); // Right
                }
                if (mazeMap[y][x] === 'E') {
                    const padlock = document.createElement('div');
                    padlock.className = 'padlock';
                    padlock.innerHTML = `<div class="padlock-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg></div>`;
                    padlock.style.transform = `translate3d(${x * TILE_SIZE}px, 0, ${y * TILE_SIZE}px)`;
                    world.appendChild(padlock);
                }
            }
        }
    }

    function updateWorldTransform() {
        const xOffset = -player.x * TILE_SIZE;
        const zOffset = -player.y * TILE_SIZE;
        world.style.transform = `translateZ(400px) rotateY(${-player.rot}deg) translateX(${xOffset}px) translateZ(${zOffset}px)`;
    }

    function handleKeyPress(e) {
        let dx = 0, dy = 0;
        const angle = player.rot * Math.PI / 180;

        if (e.key === 'ArrowUp') {
            dx = Math.sin(angle);
            dy = -Math.cos(angle);
        } else if (e.key === 'ArrowDown') {
            dx = -Math.sin(angle);
            dy = Math.cos(angle);
        } else if (e.key === 'ArrowLeft') {
            player.rot = (player.rot - 90 + 360) % 360;
        } else if (e.key === 'ArrowRight') {
            player.rot = (player.rot + 90) % 360;
        }

        if (dx !== 0 || dy !== 0) {
            const nextX = Math.round(player.x + dx);
            const nextY = Math.round(player.y + dy);

            if (mazeMap[nextY] && mazeMap[nextY][nextX] !== 1) {
                player.x = nextX;
                player.y = nextY;
                if (mazeMap[nextY][nextX] === 'E') {
                    triggerTerminal();
                }
            }
        }
        updateWorldTransform();
    }
    
    function triggerTerminal(){
        terminalScreen.style.display = 'flex';
        terminalScreen.innerHTML = `
            <div class="terminal-box">
                <h3>SYSTEM TERMINAL</h3><p>PASSWORD REQUIRED</p>
                <input type="text" id="password" placeholder="PASSWORD...">
                <button id="unlockBtn">UNLOCK</button>
            </div>`;
        document.getElementById('password').focus();
        document.getElementById('unlockBtn').onclick = checkPassword;
        document.getElementById('password').onkeyup = (e) => { if(e.key === 'Enter') checkPassword(); };
    }

    function checkPassword() {
        const pass = document.getElementById('password').value;
        if (pass.trim().toLowerCase() === 'verge') {
            terminalScreen.innerHTML = `
            <div class="terminal-box">
                <h2>ACCESS GRANTED</h2>
                <p>I'm thinking of a character. You'll have to guess who I am before I help you further. Scan here to play my game.</p>
                <img src="chatbot_qr.png" alt="QR Code to Chatbot" style="width: 200px; height: 200px; margin-top: 15px; border: 5px solid white;">
            </div>`;
        } else {
           alert('ACCESS DENIED');
           document.getElementById('password').value = '';
           document.getElementById('password').focus();
        }
    }
    
    // Hide keyboard hints after 20 seconds
    setTimeout(() => { keyboardHints.style.opacity = '0'; }, 20000);

    // Initial setup
    getStartPosition();
    createMaze();
    updateWorldTransform();
    window.addEventListener('keydown', handleKeyPress);

</script>
</body>
</html>
